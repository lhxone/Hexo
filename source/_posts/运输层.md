---
title: 计算机网络作业2
date: 2021-12-14 13:10:53
tags: 计算机网络
---
# 运输层

## 运输协议描述

### 进程通信

- 运输层为应用层进程之间的逻辑通信
- 屏蔽作用
- 可靠信道

	- 全双工TCP

- 不可靠信道

	- 无连接UDP

### 主要协议

- TCP

	- 提供可靠的、面向连接的运输服务。
	- 不提供广播或多播服务。
	- 开销较多。

- UDP

	- 传送数据之前不需要先建立连接。
	- 收到 UDP 报后，不需要给出任何确认。
	- 不提供可靠交付，但是一种最有效的工作方式。

- 用户数据报协议 UDP (User Datagram Protocol)
- 传输控制协议 TCP (Transmission Control Protocol)
- TPDU

	- 两个对等运输实体在通信时传送的数据单位叫作运输协议数据单元 TPDU (Transport Protocol Data Unit)。
	- TCP 传送的数据单位协议是 TCP 报文段 (segment)。
	- UDP 传送的数据单位协议是 UDP 报文或用户数据报。 

### 运输层端口

- 运输层从 IP 层收到发送给应用进程的数据后，必须分别交付给指明的各应用进程。
- 应用进程都可以通过运输层再传送到 IP 层（网络层
- 解决方法：在运输层使用协议端口号 (protocol port number)，或通常简称为端口 (port)。把端口设为通信的抽象终点

	- 端口用一个 16 位端口号进行标志，允许有 65,535 个不同的端口号。
	- 端口号只具有本地意义，只是为了标志本计算机应用层中的各进程。
	- 在互联网中，不同计算机的相同端口号没有联系。

## 用户数协议UDP

### 格式

- UDP 只在 IP 的数据报服务之上增加了一些功能：
- 复用和分用
- 差错检测

### 特点

- 无连接。发送数据之前不需要建立连接。
- 使用尽最大努力交付。即不保证可靠交付。
- 面向报文。UDP 一次传送和交付一个完整的报文。 
- 没有拥塞控制。网络出现的拥塞不会使源主机的发送速率降低。很适合多媒体通信的要求。 
- 支持一对一、一对多、多对一、多对多等交互通信。
- 首部开销小，只有 8 个字节。

### 

- UDP 通信的特点：简单方便，但不可靠。

### 面向报文

- 发送方 UDP 对应用层交下来的报文，既不合并，也不拆分，按照样发送。

	- 接收方 UDP 对 IP 层交上来的 UDP 用户数据报，去除首部后就原封不动地交付上层的应用进程，一次交付一个完整的报文。

- 应用程序必须选择合适大小的报文。

	- 若报文太长，IP 层在传送时可能要进行分片，降低 IP 层的效率。
	- 若报文太短，会使 IP 数据报的首部的相对长度太大，降低 IP 层的效率。

- 复用：将 UDP 用户数据报组装成不同的 IP 数据报，发送到互联网。
- 分用：根据 UDP 用户数据报首部中的目的端口号，将数据报分别传送到相应的端口，以便应用进程到端口读取数据。

### 首部格式

- 伪首部

## 传输控制协议TCP

### 特点

- TCP 是面向连接的运输层协议，在无连接的、不可靠的 IP 网络服务基础之上提供可靠交付的服务。为此，在 IP 的数据报服务基础之上，增加了保证可靠性的一系列措施。
- TCP 是面向连接的运输层协议。

	- 每一条 TCP 连接只能有两个端点 (endpoint)，每一条 TCP 连接只能是点对点的（一对一）。 
	- TCP 提供可靠交付的服务。
	- TCP 提供全双工通信。

- 面向字节流

	- TCP 中的“流”(stream) 指的是流入或流出进程的字节序列。
	- 面向字节流：虽然应用程序和 TCP 的交互是一次一个数据块，但 TCP 把应用程序交下来的数据看成仅仅是一连串无结构的字节流。
	- 特点

		- TCP 不保证接收方应用程序所收到的数据块和发送方应用程序所发出的数据块具有对应大小的关系。
		- 但接收方应用程序收到的字节流必须和发送方应用程序发出的字节流完全一样。

### 连接

- 连接端点

	- 套接字socket

		- （IP地址：端口号）
		- （192.169.1.20:2028）例子
		- 每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定

			- TCP 连接 ::= {socket1, socket2} = {(IP1: port1)，(IP2: port2)} 

		- 实现API

			- 应用编程接口  API  称为 socket API, 简称为 socket。
			- socket API 中使用的一个函数名也叫作 socket。
			- 调用 socket 函数的端点称为 socket。
			- 调用 socket 函数时其返回值称为 socket 描述符，可简称为 socket。
			- 在操作系统内核中连网协议的 Berkeley 实现，称为 socket 实现

	- 插口

### TCP首部格式

### TCP可靠传输实现

- 超时重传

	- RTO (Retransmission Time-Out) 应略大于加权平均往返时间 RTTS 。
	- RFC 6298 建议 RTO：

		- 其中：RTTD 是 RTT 偏差的加权平均值。
		- RTO = RTTS + 4  RTTD 

	- RFC 6298 建议 RTTD ：

		- 其中： 是个小于 1 的系数，其推荐值是 1/4，即 0.25。
		- 新的 RTTD = (1   )  (旧的 RTTD)  +    RTTS  新的 RTT 样本

- 选择确认SACK

### TCP流量控制

### TCP拥塞控制

- 算法

	- 慢开始 (slow-start)

		- 目的：探测网络的负载能力或拥塞程度。
		- 算法：由小到大逐渐增大注入到网络中的数据字节，即：由小到大逐渐增大拥塞窗口数值。
		- 2 个控制变量：

			- 拥塞窗口cwnd
			- 慢开始门限ssthresh

		- 拥塞窗口 cwnd 增大：在每收到一个对新的报文段的确认，就把拥塞窗口增加最多一个发送方的最大报文段 SMSS  (Sender Maximum Segment Size) 的数值。
		-       其中 N 是原先未被确认的、但现在被刚收到的确认报文段所确认的字节数

	- 拥塞避免 (congestion avoidance)
	- 快重传 (fast retransmit)
	- 快恢复 (fast recovery)

### TCP运输连接管理

- 过程

	- 建立
	- 连接释放

		- 第一，保证发送的最后一个 ACK 报文段能够到达 B。
		- 第二，防止“已失效的连接请求报文段”出现在本连接中。
		- 保活计时器

			- 用来防止在 TCP 连接出现长时期空闲。
			- 通常设置为 2 小时 。
			- 若服务器过了 2 小时还没有收到客户的信息，它就发送探测报文段。
			- 若发送了 10 个探测报文段（每一个相隔 75 秒）还没有响应，就假定客户出了故障，因而就终止该连接。 

	- 有限状态机

- 模式

	- TCP 连接的建立采用客户服务器方式。
	- 主动发起连接建立的应用进程叫做客户 (client)。
	- 被动等待连接建立的应用进程叫做服务器 (server)。

- 握手

	- TCP 建立连接的过程叫做握手。
	- 采用三报文握手：在客户和服务器之间交换三个 TCP 报文段，以防止已失效的连接请求报文段突然又传送到了，因而产生 TCP 连接建立错误。

## 可靠运输的工作原理

### 停止等待协议

- 概念

	- 每发送完一个分组就停止发送，等待对方的确认。在收到确认后再发送下一个分组。
	- 全双工通信的双方既是发送方也是接收方。
	- 假设仅考虑 A 发送数据，而 B 接收数据并发送确认。因此 A 叫做发送方，而 B 叫做接收方。

- 状态情况

	- 无差错
	- 有差错

		- 两种情况：
		- B 接收 M1 时检测出了差错，就丢弃 M1，其他什么也不做（不通知 A 收到有差错的分组）。
		- M1 在传输过程中丢失了，这时 B 当然什么都不知道，也什么都不做。

	- 解决办法

		- 超时重传

			- A 为每一个已发送的分组设置一个超时计时器。
			- A 只要在超时计时器到期之前收到了相应的确认，就撤销该超时计时器，继续发送下一个分组 M2 。
			- 若 A 在超时计时器规定时间内没有收到 B 的确认，就认为分组错误或丢失，就重发该分组。

		- 确认丢失

			- 若 B 所发送的对 M1 的确认丢失了，那么 A 在设定的超时重传时间内将不会收到确认，因此 A 在超时计时器到期后重传 M1。
			- 假定 B 正确收到了 A 重传的分组 M1。这时 B 应采取两个行动：

				- (1) 丢弃这个重复的分组 M1，不向上层交付。
				- (2) 向 A 发送确认。

		- 确认迟到

			- B 对分组 M1 的确认迟到了，因此 A 在超时计时器到期后重传 M1。
			- B 会收到重复的 M1，丢弃重复的 M1，并重传确认分组。
			- A 会收到重复的确认。对重复的确认的处理：丢弃。

	- 信道利用率

		- 

- 要点

	- 停止等待。发送方每次只发送一个分组。在收到确认后再发送下一个分组。
	- 暂存：在发送完一个分组后，发送方必须暂存已发送的分组的副本，以备重发。
	- 编号。对发送的每个分组和确认都进行编号。
	- 超时重传。发送方为发送的每个分组设置一个超时计时器。若超时计时器超时位收到确认，发送方会自动超时重传分组。
	- 超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些，防止不必要的重传。

- 进化，流水线传输

### 连续ARQ协议

- 概念结构

	- 发送窗口：发送方维持一个发送窗口，位于发送窗口内的分组都可被连续发送出去，而不需要等待对方的确认。
	- 发送窗口滑动：发送方每收到一个确认，就把发送窗口向前滑动一个分组的位置。
	- 累积确认：接收方对按序到达的最后一个分组发送确认，表示：到这个分组为止的所有分组都已正确收到了。

